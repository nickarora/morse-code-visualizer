class t extends Error{constructor(){super("Missing required argument"),this.name="ArgumentError"}}function e(e){if(null==e)throw new t;return e}function r(t){return 1.2/t*1e3}const s="clock";class i{static configure(t,e){e||=s,t[e]=new this}now(){return(new Date).getTime()}}class n{_time=null;static configure(t,e){e||=s,t[e]=new this}set(t){this._time=t}now(){return this._time}}const h="scheduler";class c{_timeoutIDs=[];static configure(t,e){e||=h,t[e]=new this}schedule(t,e){const r=setTimeout(()=>{t()},e);this.recordTimeoutID(r)}recordTimeoutID(t){this._timeoutIDs.push(t)}cancelAll(){this._timeoutIDs.forEach(t=>{clearTimeout(t)}),this._timeoutIDs=[]}}class o{_invocations=[];static configure(t,e){e||=h,t[e]=new this}schedule(t,e){this._invocations.push({method:"schedule",arguments:{func:t,delay:e}})}cancelAll(){this._invocations.push({method:"cancelAll"})}hasScheduled(t,e){return this._invocations.some(r=>"schedule"==r.method&&r.arguments.func.toString()===t.toString()&&r.arguments.delay===e)}hasCanceledAll(){return this._invocations.some(t=>"cancelAll"==t.method)}}const a=Object.freeze({dit:".",dah:"-"}),u="signalReader";class d{static configure(t,e,r){r||=u,t[r]=new this(e)}constructor(t){this.elementDuration=e(t)}read(t){return t<=0?null:t<=this.elementDuration?a.dit:a.dah}}class l{_records=[];_element=null;static configure(t,e){e||=u,t[e]=new this}setElement(t){this._element=t}read(t){return this._records.push(t),this._element}hasRead(t){return t?this._records.some(e=>e==t):this._records.length>0}}class m{_elements=[];constructor(t=[]){this._elements=t}toString(){return this._elements.join("")}addElement(t){this._elements.push(t)}elements(){return this._elements}forEachElement(t){return this._elements.forEach(t)}isEmpty(){return 0==this._elements.length}clear(){this._elements=[]}dup(){return new m(this._elements)}}class g{_characters=[];constructor(t=[]){this._characters=t}toString(){return this._characters.map(t=>t.toString()).join("")}addCharacter(t){this._characters.push(t)}characters(){return this._characters}forEachCharacter(t){return this._characters.forEach(t)}isEmpty(){return 0==this._characters.length}clear(){this._characters=[]}dup(){return new g(this._characters.map(t=>t.dup()))}}class p{static build(t,e={}){t||=8;const s=r(t),n=new p(s,e);return i.configure(n),c.configure(n),d.configure(n,s),n}constructor(t,r={}){this.elementDuration=e(t),this.options=r,this.characterDuration=3*t,this.wordDuration=7*t,this.startSignalTime=null,this.stopSignalTime=null,this.currentCharacter=new m,this.currentWord=new g,this.previousWords=[],n.configure(this),o.configure(this),l.configure(this)}signalOn(){this.scheduler.cancelAll(),this.startSignalTime=this.clock.now()}signalOff(){this.stopSignalTime=this.clock.now(),this.readSignal(),this.scheduler.schedule(this.recordCharacter.bind(this),this.characterDuration),this.scheduler.schedule(this.recordWord.bind(this),this.characterDuration+this.wordDuration)}readSignal(){if(!this.startSignalTime||!this.stopSignalTime)return;const t=this.stopSignalTime-this.startSignalTime,e=this.signalReader.read(t);e&&this.appendElement(e)}appendElement(t){this.currentCharacter.addElement(t),this.options.onCharacterChange&&this.options.onCharacterChange(this.currentCharacter)}recordCharacter(){this.currentCharacter.isEmpty()||(this.currentWord.addCharacter(this.currentCharacter),this.options.onWordChange&&this.options.onWordChange(this.currentWord),this.currentCharacter=new m,this.options.onCharacterChange&&this.options.onCharacterChange(this.currentCharacter))}recordWord(){this.currentWord.isEmpty()||(this.previousWords.push(this.currentWord),this.options.onWordAdded&&this.options.onWordAdded(this.previousWords),this.currentWord=new g,this.options.onWordChange&&this.options.onWordChange(this.currentWord))}setWordsPerMinute(t){const e=r(t);this.elementDuration=e,this.characterDuration=3*e,this.wordDuration=7*e}}const _={".-":"A","-...":"B","-.-.":"C","-..":"D",".":"E","..-.":"F","--.":"G","....":"H","..":"I",".---":"J","-.-":"K",".-..":"L","--":"M","-.":"N","---":"O",".--.":"P","--.-":"Q",".-.":"R","...":"S","-":"T","..-":"U","...-":"V",".--":"W","-..-":"X","-.--":"Y","--..":"Z"};const C={Encoder:p,Decoder:class{static decodeWords(t){return t.map(t=>this.decodeWord(t)).join(" ")}static decodeWord(t){return t.characters().map(this.decodeCharacter).join("")}static decodeCharacter(t){const e=_[t.toString()];return e||""}}};window.Morse=C;
